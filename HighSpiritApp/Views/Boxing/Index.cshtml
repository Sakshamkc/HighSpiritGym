@model List<HighSpiritApp.Models.Boxing.BoxingMember>
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h4 class="mb-3">Boxing Members</h4>

<form method="get" class="mb-3">
    <div class="d-flex flex-wrap gap-2 align-items-center">
        <div class="input-group" style="max-width:1440px;">
            <input name="search"
                   value="@ViewBag.Search"
                   class="form-control"
                   placeholder="Search by kid or guardian name"
                   autocomplete="off"/>
            <button class="btn btn-primary">
                <i class="fa-solid fa-search"></i>
            </button>
        </div>

        <a href="/Boxing/ExportAll"
           class="btn btn-success btn-lg ms-auto">
            <i class="fa-solid fa-file-excel"></i> Export Excel
        </a>
    </div>
</form>

<div class="card shadow">
    <div class="card-body p-0">

        <table class="table table-hover table-striped mb-0">
            <thead class="table-dark">
                <tr>
                    <th>#</th>
                    <th>Photo</th>
                    <th>Name</th>
                    <th>Joined</th>
                    <th>Guardian Name</th>
                    <th>Contact</th>
                    <th>Per Month Class</th>
                    <th>Cash</th>
                    <th>eSewa</th>
                    <th>Due</th>
                    <th>Remarks</th>
                    <th>Actions</th>
                </tr>
            </thead>

            <tbody>
                @{
                    int sn = (ViewBag.Page - 1) * 10 + 1;
                }

                @foreach (var b in Model)
                {
                    <tr>
                        <td>@sn</td>

                        <!-- Photo -->
                        <td>
                            @if (b.Photo != null)
                            {
                                <img src="data:image/jpeg;base64,@Convert.ToBase64String(b.Photo)"
                                     class="rounded-circle"
                                     style="width:40px;height:40px;object-fit:cover;" />
                            }
                            else
                            {
                                <i class="fa-solid fa-child fa-lg text-secondary"></i>
                            }
                        </td>

                        <!-- Name -->
                        <td>@b.Name</td>

                        <!-- Joined -->
                        <td>
                            @if (b.JoinDate != null)
                            {
                                var sdeb = b.JoinDate.Value;
                                string sdebSuffix =
                                sdeb.Day % 10 == 1 && sdeb.Day != 11 ? "st" :
                                sdeb.Day % 10 == 2 && sdeb.Day != 12 ? "nd" :
                                sdeb.Day % 10 == 3 && sdeb.Day != 13 ? "rd" : "th";

                                @($"{sdeb.Day}{sdebSuffix} {sdeb:MMMM yyyy}")
                            }
                            else
                            {
                                @("-")
                            }
                        </td>


                        <!-- Guardian -->
                        <td>@b.GuardianName</td>

                        <!-- Contact -->
                        <td>
                            <a href="tel:@b.GuardianContact">
                                @b.GuardianContact
                            </a>
                        </td>

                        <!-- Per Month Class -->
                        <td>
                            <span class="badge bg-info text-dark">
                                @b.PerMonthClass
                            </span>
                        </td>

                        <!-- Cash -->
                        <td>
                            <span class="text-primary fw-semibold">
                                @b.CashAmount
                            </span>
                        </td>

                        <!-- eSewa -->
                        <td>
                            <span class="text-warning fw-semibold">
                                @b.EsewaAmount
                            </span>
                        </td>
                      
                        <!-- Due -->
                        <td>
                            @if (b.DueAmount > 0)
                            {
                                <span class="badge bg-danger">
                                    @b.DueAmount
                                </span>
                            }
                            else
                            {
                                <span class="badge bg-success">
                                    0
                                </span>
                            }
                        </td>

                        <!-- Remarks -->
                        <td title="@b.Remarks">
                            @(string.IsNullOrWhiteSpace(b.Remarks)
                                ? "-"
                                : (b.Remarks.Length > 20
                                ? b.Remarks.Substring(0, 20) + "..."
                                : b.Remarks))
                        </td>

                        <td>
                            <a class="btn btn-sm btn-primary"
                               href="/Boxing/Details/@b.BoxingMemberID">
                                View
                            </a>
                            <a class="btn btn-sm btn-secondary"
                               href="/Boxing/Edit/@b.BoxingMemberID">
                                Edit
                            </a>
                        </td>
                    </tr>

                    sn++;
                }
            </tbody>

        </table>

        <!-- Pagination -->
        <nav class="mt-3">
            <ul class="pagination justify-content-center">
                @for (int i = 1; i <= ViewBag.TotalPages; i++)
                {
                    <li class="page-item @(i == ViewBag.Page ? "active" : "")">
                        <a class="page-link"
                           href="?page=@i&search=@ViewBag.Search">@i</a>
                    </li>
                }
            </ul>
        </nav>

    </div>
</div>
