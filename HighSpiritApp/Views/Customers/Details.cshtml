@model HighSpiritApp.Models.Customer
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    var m = Model.Memberships?.OrderByDescending(x => x.StartDate).FirstOrDefault();
}
@{
    var today = DateTime.Today;
}
<a class="btn btn-secondary mb-3"
   href="/Customers/EditAll/@Model.CustomerID">
    Edit Customer Details
</a>

<a class="btn btn-success mb-3"
   href="/Memberships/Renew/@Model.CustomerID">
    Renew Membership
</a>

<div class="card shadow">
    <div class="card-body">

        <div class="row">
            <div class="col-md-4 text-center">
                @if (Model.Photo != null)
                {
                    <img src="data:image/png;base64,@Convert.ToBase64String(Model.Photo)"
                         class="mb-3 border shadow"
                         style="
        width:240px;
        height:240px;
        object-fit:cover;
        border-radius:12px;
             " />

                }
                else
                {
                    <img src="https://via.placeholder.com/180"
                         class="rounded-circle mb-3" />
                }
                <h4>@Model.FullName</h4>
                <p class="text-muted">@Model.Phone</p>
            </div>

            <div class="col-md-8">
                <h5>Personal Details</h5>
                <table class="table table-bordered">
                    <tr><th>Email</th><td>@Model.Email</td></tr>
                    <tr><th>Gender</th><td>@Model.Gender</td></tr>
                    <tr>
                        <th>DOB</th>
                        <td>
                                @{
                                var sdee = Model.DateOfBirth;
                                    string sdeeeSuffix =
                                sdee.Day % 10 == 1 && sdee.Day != 11 ? "st" :
                                sdee.Day % 10 == 2 && sdee.Day != 12 ? "nd" :
                                sdee.Day % 10 == 3 && sdee.Day != 13 ? "rd" : "th";
                                }
                            @($"{sdee.Day}{sdeeeSuffix} {sdee:MMMM yyyy}")
                        </td>
                    </tr>
                    <tr>
                        <th>Join Date</th>
                        <td>
                            @{
                                var sde = Model.JoinDate;
                                string sdeSuffix =
                                sde.Day % 10 == 1 && sde.Day != 11 ? "st" :
                                sde.Day % 10 == 2 && sde.Day != 12 ? "nd" :
                                sde.Day % 10 == 3 && sde.Day != 13 ? "rd" : "th";
                            }
                            @($"{sde.Day}{sdeSuffix} {sde:MMMM yyyy}")
                        </td>
                    </tr>
                    <tr><th>Address</th><td>@Model.Address</td></tr>
                    <tr><th>Blood Group</th><td>@Model.BloodGroup</td></tr>
                    <tr><th>Height</th><td>@Model.Height</td></tr>
                    <tr><th>Weight</th><td>@Model.WeightKG</td></tr>
                    <tr><th>Occupation</th><td>@Model.Occupation</td></tr>
                    <tr>
                        <th>Shift</th>
                        <td>@Model.Shift</td>
                    </tr>
                    <tr>
                        <th>Remarks</th>
                        <td>@Model.Remarks</td>
                    </tr>

                </table>
            </div>
        </div>

        <hr />

        <h5>Membership Details</h5>
        @if (Model.Memberships != null && Model.Memberships.Any())
        {
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Plan</th>
                        <th>Price</th>
                        <th>Start</th>
                        <th>Expire</th>
                        <th>Duration</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var history in Model.Memberships.OrderByDescending(x => x.StartDate))
                    {
                        <tr>
                            <td>@history.PlanName</td>
                            <td>@history.PaidPrice</td>

                            <td>
                                @{
                                    var sd = history.StartDate;
                                    string sdSuffix =
                                    sd.Day % 10 == 1 && sd.Day != 11 ? "st" :
                                    sd.Day % 10 == 2 && sd.Day != 12 ? "nd" :
                                    sd.Day % 10 == 3 && sd.Day != 13 ? "rd" : "th";
                                }
                                @($"{sd.Day}{sdSuffix} {sd:MMMM yyyy}")
                            </td>

                            <td>
                                @if (history.ExpireDate != null)
                                {
                                    var ed = history.ExpireDate.Value;
                                    string edSuffix =
                                    ed.Day % 10 == 1 && ed.Day != 11 ? "st" :
                                    ed.Day % 10 == 2 && ed.Day != 12 ? "nd" :
                                    ed.Day % 10 == 3 && ed.Day != 13 ? "rd" : "th";

                                    @($"{ed.Day}{edSuffix} {ed:MMMM yyyy}")
                                }
                                else
                                {
                                    @("-")
                                }
                            </td>

                            <td>@history.Duration</td>
                        </tr>
                    }


                </tbody>
            </table>
        }

        else
        {
            <p class="text-danger">No membership found.</p>
        }

        <a href="/Customers" class="btn btn-secondary mt-3">Back</a>

    </div>
</div>
