@model HighSpiritApp.Models.Customer
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    var m = Model.Memberships?.OrderByDescending(x => x.StartDate).FirstOrDefault();
}
<a class="btn btn-secondary mb-3"
   href="/Customers/EditAll/@Model.CustomerID">
    Edit Customer Details
</a>

<a class="btn btn-success mb-3"
   href="/Memberships/Renew/@Model.CustomerID">
    Renew Membership
</a>

<div class="card shadow">
    <div class="card-body">

        <div class="row">
            <div class="col-md-4 text-center">
                @if (Model.Photo != null)
                {
                    <img src="data:image/png;base64,@Convert.ToBase64String(Model.Photo)"
                         class="mb-3 border shadow"
                         style="
        width:240px;
        height:240px;
        object-fit:cover;
        border-radius:12px;
             " />

                }
                else
                {
                    <img src="https://via.placeholder.com/180"
                         class="rounded-circle mb-3" />
                }
                <h4>@Model.FullName</h4>
                <p class="text-muted">@Model.Phone</p>
            </div>

            <div class="col-md-8">
                <h5>Personal Details</h5>
                <table class="table table-bordered">
                    <tr><th>Email</th><td>@Model.Email</td></tr>
                    <tr><th>Gender</th><td>@Model.Gender</td></tr>
                    <tr><th>DOB</th><td>@Model.DateOfBirth.ToShortDateString()</td></tr>
                    <tr><th>Join Date</th><td>@Model.JoinDate.ToShortDateString()</td></tr>
                    <tr><th>Address</th><td>@Model.Address</td></tr>
                    <tr><th>Blood Group</th><td>@Model.BloodGroup</td></tr>
                    <tr><th>Height</th><td>@Model.Height</td></tr>
                    <tr><th>Weight</th><td>@Model.WeightKG</td></tr>
                </table>
            </div>
        </div>

        <hr />

        <h5>Membership Details</h5>
        @if (Model.Memberships != null && Model.Memberships.Any())
        {
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Plan</th>
                        <th>Price</th>
                        <th>Start</th>
                        <th>Expire</th>
                        <th>Duration</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var history in Model.Memberships.OrderByDescending(x => x.StartDate))
                    {
                        <tr>
                            <td>@history.PlanName</td>
                            <td>@history.PaidPrice</td>
                            <td>@history.StartDate.ToShortDateString()</td>
                            <td>@history.ExpireDate.ToShortDateString()</td>
                            <td>@history.Duration</td>
                            <td>
                                @if (history.IsActive)
                                {
                                    <span class="badge bg-success">Active</span>
                                }
                                else
                                {
                                    <span class="badge bg-secondary">Expired</span>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }

        else
        {
            <p class="text-danger">No membership found.</p>
        }

        <a href="/Customers" class="btn btn-secondary mt-3">Back</a>

    </div>
</div>
